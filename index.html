<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Open Miami - Hotline Miami Clone</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: monospace;
            color: #fff;
        }
        #game-container {
            text-align: center;
        }
        canvas {
            border: 2px solid #ff1744;
            box-shadow: 0 0 20px rgba(255, 23, 68, 0.5);
        }
        h1 {
            color: #ff1744;
            text-shadow: 0 0 10px rgba(255, 23, 68, 0.8);
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #ff1744;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>ðŸ”¥ OPEN MIAMI ðŸ”¥</h1>
        <div id="loading">Loading...</div>
        <canvas id="glcanvas" tabindex='1' width="960" height="720"></canvas>
        <p>An open-source Hotline Miami clone in Rust</p>
    </div>
    <script type="module">
        // Cache busting - add version timestamp
        const version = Date.now();
        import(`./open_miami.js?v=${version}`).then(async ({ default: init, start }) => {
            async function run() {
                try {
                    // Initialize the WASM module
                    await init();
                    // Ensure DOM is loaded before starting game
                    console.log('Canvas element:', document.getElementById('glcanvas'));
                    // Start the game
                    start();
                    document.getElementById('loading').style.display = 'none';
                    console.log('Game loaded successfully!');
                } catch (error) {
                    console.error('Failed to load game:', error);
                    document.getElementById('loading').textContent = 'Failed to load game. Check console for details.';
                    document.getElementById('loading').style.color = '#ff0000';
                }
            }

            // Wait for DOM to be fully loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', run);
            } else {
                run();
            }
        });
    </script>
</body>
</html>
